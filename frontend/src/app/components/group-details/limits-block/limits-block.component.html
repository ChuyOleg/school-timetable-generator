<form *ngIf="isLoaded" (ngSubmit)="submit()">

  <div
    *ngIf="subjectService.subjects"
    class=""
  >
    <div *ngFor="let subject of pickedSubjects | sortSubjectsByName" class="mb-2">

      <div
        class="py-2 flex justify-center border-b border-gray-500 rounded"
        [ngClass]="{'animate-ping' : unpickedSubjects.includes(subject)}"
      >

        <div class="w-1/4 py-2">
          <h2 class="text-center font-bold">{{ subject.name }}</h2>
        </div>

        <div class="w-1/4 text-center relative">
          <input
            type="text"
            class="border w-1/4 py-2 px-2 text-center"
            placeholder="xxx"
            [formControl]="getSubjectHoursFormControl(subject)"
            maxlength="4"
          >
          <span class="italic text-lg font-bold ml-2">h/week</span>

          <p
            class="text-red-600 italic font-mono font-bold mb-2"
            *ngIf="(getSubjectHoursFormControl(subject).errors?.required || getSubjectHoursFormControl(subject).errors?.pattern
         || getSubjectHoursFormControl(subject).errors?.min || getSubjectHoursFormControl(subject).errors?.max)
         && (getSubjectHoursFormControl(subject).dirty || submitButtonIsPressed)"
          >0.5 - 10 h/week</p>

          <button
            type="button"
            *ngIf="!subGroup2IsOpen(subject)"
            class="rounded-full bg-green-400 text-white absolute right-0 bottom-0 px-2 hover:animate-spin"
            (click)="addSubGroup2(subject)"
          >+</button>

          <button
            type="button"
            *ngIf="subGroup2IsOpen(subject)"
            class="rounded bg-red-600 text-white absolute right-0 bottom-0 px-2 hover:animate-spin"
            (click)="removeSubGroup2(subject)"
          >&times;</button>
        </div>

        <div class="w-2/4 grid grid-cols-2 relative">
          <div class="w-full text-center">
            <mat-form-field appearance="fill" class="w-5/6">
              <mat-label>Teacher</mat-label>
              <mat-select [formControl]="getSubjectTeacherFormControl(subject)" [compareWith]="compareTeachers">
                <mat-option
                  *ngFor="let teacher of teacherService.teachers |
                    filterTeachersBySubject: subject |
                    addClassTeacherForPrimarySchool: group"
                  [value]="teacher">{{ teacher.name }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="w-full text-center">
            <mat-form-field appearance="fill" class="w-5/6">
              <mat-label>Room</mat-label>
              <mat-select [formControl]="getSubjectRoomFormControl(subject)" [compareWith]="compareRooms">
                <mat-option *ngFor="let room of roomService.rooms" [value]="room">{{ room.name }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <button
            type="button"
            class="absolute -right-8 top-0 py-6 px-3 bg-transparent hover:bg-red-500
             text-red-700 font-semibold hover:text-white py-2 px-4 border border-2
              border-red-500 hover:border-transparent rounded"
            (click)="unpickSubject(subject)"
          >&times;</button>

          <div class="w-full text-center" *ngIf="subGroup2IsOpen(subject)">
            <mat-form-field appearance="fill" class="w-5/6">
              <mat-label>Teacher</mat-label>
              <mat-select [formControl]="getSubjectTeacherSubGroup2FormControl(subject)" [compareWith]="compareTeachers">
                <mat-option
                  *ngFor="let teacher of teacherService.teachers |
                    filterTeachersBySubject: subject |
                    addClassTeacherForPrimarySchool: group"
                  [value]="teacher">{{ teacher.name }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="w-full text-center" *ngIf="subGroup2IsOpen(subject)">
            <mat-form-field appearance="fill" class="w-5/6">
              <mat-label>Room</mat-label>
              <mat-select [formControl]="getSubjectRoomSubGroup2FormControl(subject)" [compareWith]="compareRooms">
                <mat-option *ngFor="let room of roomService.rooms" [value]="room">{{ room.name }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

        </div>

      </div>
    </div>
  </div>

  <div class="relative flex">
    <div class="w-1/3">
      <button
        class="py-6 px-3 bg-transparent hover:bg-green-500
           text-green-700 font-semibold hover:text-white py-2 px-4 border border-2
            border-green-500 hover:border-transparent rounded"
        type="button"
        [disabled]="!newSubjectFormControl.valid"
        (click)="pickSubject()"
      >+</button>

      <mat-form-field appearance="fill" class="w-4/6 ml-3 mt-2">
        <mat-label>Select Subjects</mat-label>
        <mat-select [formControl]="newSubjectFormControl">
          <mat-option *ngFor="let subject of unpickedSubjects" [value]="subject">{{ subject.name }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="flex w-2/3 mt-2">
      <div class="w-1/12   relative">
        <span class="">IETC</span>
        <button
          type="button"
          *ngIf="!interschoolCombineIsPicked"
          class="rounded-full bg-green-400 text-white absolute left-1 top-7 px-2 hover:animate-spin"
          (click)="toggleInterschoolCombine()"
        >+</button>

        <button
          type="button"
          *ngIf="interschoolCombineIsPicked"
          class="rounded bg-red-600 text-white absolute left-1 top-7 px-2 hover:animate-spin"
          (click)="toggleInterschoolCombine()"
        >&times;</button>
      </div>

      <div class="w-5/6">
        <div *ngIf="interschoolCombineIsPicked" class="w-full flex">
          <div class="w-1/3 text-center">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Day</mat-label>
              <mat-select [formControl]="interschoolCombineDay">
                <mat-option *ngFor="let day of days" [value]="day">{{ day }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="w-1/3 text-center">
            <mat-form-field appearance="fill" class="w-full ml-2">
              <mat-label>Lesson number</mat-label>
              <mat-select [formControl]="interschoolCombineLessonNumber">
                <mat-option *ngFor="let lessonNumber of lessonNumbers" [value]="lessonNumber">{{ lessonNumber }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="group" class="absolute right-5 top-4 border-b-2 border-b-black">
      <mat-icon class="text-base">access_time</mat-icon>
      <span class="text-center">{{ maxHoursPerWeek.value }}</span>
      <span class="italic text-lg font-bold ml-2">h/week</span>
    </div>

    <p
      *ngIf="(maxHoursPerWeek.errors?.required || maxHoursPerWeek.errors?.pattern
         || maxHoursPerWeek.errors?.min || maxHoursPerWeek.errors?.max)
         && (maxHoursPerWeek.dirty || submitButtonIsPressed)"
      class="absolute right-3 top-14 text-red-600 italic font-mono font-bold"
    >1 - 40 h/week</p>

  </div>

  <div class="text-center">

    <button
      type="submit"
      class="bg-transparent hover:bg-blue-500 text-blue-700 font-semibold
       hover:text-white py-2 px-4 border border-2 border-blue-500 hover:border-transparent rounded"
      [ngClass]="{ 'hover:bg-yellow-500 text-yellow-600 border-yellow-500' : isCreated }"
    >{{ isCreated ? 'Update' : 'Save' }}</button>

  </div>

</form>
